{% extends 'base.html' %}
{% load static i18n %}

{% block title %}{{ item.title }} — AnnArt{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/material_detail.css' %}">
    <link rel="stylesheet" href="{% static 'css/products.css' %}">
{% endblock %}

{% block content %}
<section class="material-detail-section">
    <div class="container">
        <div class="row gx-4">
            <!-- Левая колонка - изображения -->
            <div class="col-lg-7 animate-fade-in" style="animation-delay: 0.1s;">
                <div class="main-image-container">
                    {% if item.image %}
                        <img src="{{ item.image.url }}" alt="{{ item.title }}" class="img-fluid" id="mainImage">
                    {% else %}
                        <img src="{% static 'images/default-material.jpg' %}" alt="Default image" class="img-fluid" id="mainImage">
                    {% endif %}
                    
                    {% if item.additional_images.all %}
                        <div class="gallery-thumbnails">
                            {% for img in item.additional_images.all %}
                                <div class="thumbnail" onclick="changeMainImage('{{ img.image.url }}')">
                                    <img src="{{ img.image.url }}" alt="Доп. изображение {{ forloop.counter }}">
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Правая колонка - информация -->
            <div class="col-lg-5 animate-fade-in" style="animation-delay: 0.3s;">
                <div class="material-info">
                    <span class="category-badge">{{ item.category.title }}</span>
                    <h1 class="material-title">{{ item.title }}</h1>
                    
                    {% if item.description %}
                        <div class="material-description">
                            {{ item.description|linebreaks }}
                        </div>
                    {% else %}
                        <p class="empty-description">{% trans "Описание отсутствует." %}</p>
                    {% endif %}
                    
                    <div class="mt-4">
                        <a href="{% url 'material_items_by_category' item.category.id %}" class="btn btn-outline-secondary">
                            <i class="fas fa-arrow-left me-2"></i>{% trans "Назад к категории" %} 
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Дополнительная информация или похожие товары -->
<section class="py-2 bg-light">
    <div class="container">
        <h2 class="text-center mb-5">{% trans "Другие материалы из категории" %}</h2>
        
        <div class="row g-4">
            {% for related in item.category.materialitem_set.all %}
                {% if related.id != item.id %}
                    <div class="col-md-3 col-lg-2">
                        <div class="material-card h-100">
                            <a href="{% url 'material_detail' related.pk %}">
                                <div class="material-image">
                                    {% if related.image %}
                                        <img src="{{ related.image.url }}" alt="{{ related.title }}">
                                    {% else %}
                                        <img src="{% static 'images/default-material.jpg' %}" alt="Default image">
                                    {% endif %}
                                    <div class="material-text-content">
                                        <h5>{{ related.title }}</h5>
                                        {% if related.description %}
                                            <p>{{ related.description|truncatewords:15 }}</p>
                                        {% endif %}
                                    </div>
                                </div>
                            </a>
                        </div>
                    </div>
                {% endif %}
            {% empty %}
                <div class="col-12 text-center">
                    <p class="text-muted">Нет других материалов в этой категории</p>
                </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
    function changeMainImage(newSrc) {
        document.getElementById('mainImage').src = newSrc;
        
        const mainImage = document.getElementById('mainImage');
        mainImage.style.opacity = 0;
        setTimeout(() => {
            mainImage.style.opacity = 1;
            mainImage.style.transition = 'opacity 0.3s ease';
        }, 10);
    }
</script>
{% endblock %}

{% block dashboard %}
{% endblock dashboard %}